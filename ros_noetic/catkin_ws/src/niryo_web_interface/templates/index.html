<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niryo 機械手臂控制台</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Add D3.js for advanced tree visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-brand">
            <h1>🤖 Niryo 控制台</h1>
        </div>
        <div class="nav-status">
            <div class="status-group">
                <span class="status-label">攝影機狀態:</span>
                <div class="status-indicator" id="status-indicator"></div>
                <span class="status-text" id="status-text">檢查中...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Camera Section -->
        <section class="camera-section">
            <div class="camera-header">
                <h2>即時影像</h2>
                <button class="btn btn-secondary" id="camera-reconnect-btn" onclick="reconnectCamera()">
                    📷 重新連接
                </button>
            </div>
            <div class="camera-container">
                <img id="camera-stream" src="{{ url_for('video') }}" alt="Camera stream" class="camera-feed">
            </div>
        </section>

        <!-- Control Panel -->
        <aside class="control-panel">
            <!-- Robot Controls -->
            <div class="control-group">
                <h3>機械手臂控制</h3>
                <div class="button-grid">
                    <button class="btn btn-primary" onclick="open_and_close('open')">
                        👐 打開夾爪
                    </button>
                    <button class="btn btn-primary" onclick="open_and_close('close')">
                        ✊ 夾取物體
                    </button>
                    <button class="btn btn-warning" onclick="setLearningMode()">
                        🎯 Learning Mode
                    </button>
                    <button class="btn btn-success" onclick="moveToHome()">
                        🏠 回到起始位置
                    </button>
                </div>
            </div>

            <!-- Object Detection -->
            <div class="control-group">
                <h3>物體檢測與抓取</h3>
                <div class="button-grid">
                    <button class="btn btn-info" onclick="pickObject('blue_block')">
                        🔵 抓藍色方塊
                    </button>
                    <button class="btn btn-danger" onclick="pickObject('red_block')">
                        🔴 抓紅色方塊
                    </button>
                </div>
            </div>

            <!-- Voice Control -->
            <div class="control-group">
                <h3>語音控制</h3>
                <button class="btn btn-voice" id="voice-btn" onclick="startVoiceInput()">
                    🎤 語音輸入
                </button>
            </div>

            <!-- Behavior Tree Visualization -->
            <div class="control-group">
                <h3>行為樹狀態</h3>
                <div class="tree-controls">
                    <button class="btn btn-secondary btn-small" onclick="expandTree()">
                        🌳 展開
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="collapseTree()">
                        📊 收縮
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="centerTree()">
                        🎯 置中
                    </button>
                </div>

                <div class="d3-tree-container" id="d3-tree-container">
                    <svg id="tree-svg"></svg>
                    <div class="tree-legend">
                        <div class="legend-item">
                            <div class="legend-status success"></div>
                            <span>成功</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-status running"></div>
                            <span>執行中</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-status failure"></div>
                            <span>失敗</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-status invalid"></div>
                            <span>無效</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

